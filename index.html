<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智表 (Smartable) - AI表格助手 MVP</title>
    <!-- 使用 Vite/模块化入口（CSS 由 src/main.js 引入） -->
    <script type="module" src="/src/main.js"></script>
</head>
<body>
    <!-- 移动端顶部栏（桌面端隐藏） -->
    <header id="mobile-topbar" class="mobile-topbar" aria-label="移动端导航" hidden>
        <button type="button" id="mobile-menu-toggle" class="mobile-icon-btn" aria-label="打开侧边栏">☰</button>
        <div class="mobile-brand" aria-live="polite">
            <span class="brand-name">新会话</span>
        </div>
        <div class="mobile-actions">
            <button id="mobile-new-btn" class="mobile-icon-btn" type="button" aria-label="新会话">＋</button>
            <button id="mobile-dark-toggle" class="mobile-icon-btn" type="button" aria-label="切换深浅色">🌙</button>
            <button id="mobile-style-toggle" class="mobile-icon-btn" type="button" aria-label="切换风格" title="切换风格">🎨</button>
        </div>
    </header>
    <aside id="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <h1>智表</h1>
                <p class="brand-tagline">轻松制表</p>
            </div>
        </div>
        <div class="sidebar-scroll">
            <section id="conversation-list" class="sidebar-section" aria-label="会话列表">
                <header class="sidebar-section-header">
                    <h2>会话</h2>
                    <button type="button" class="section-toggle" data-target="conversation-list">▾</button>
                </header>
                <div class="section-body">
                    <ul id="conv-items" class="conv-items" role="list">
                        <li class="conv-item active" role="listitem" aria-current="true">当前会话</li>
                    </ul>
                    <div class="conv-actions">
                        <button type="button" id="conv-new" class="chart-suggestion-btn">新建会话</button>
                    </div>
                </div>
            </section>
            <section id="product-intro" class="sidebar-section" aria-label="产品介绍">
                <header class="sidebar-section-header">
                    <h2>能帮你做什么？</h2>
                    <button type="button" class="section-toggle" data-target="product-intro">▾</button>
                </header>
                <div class="section-body">
                    <p class="intro-copy">智表是一个“对话式表格助手”。不会写公式，也能把数据清洗、统计、出图、导出一气呵成。</p>
                    <div class="intro-chips" role="list">
                        <button type="button" class="intro-chip" data-sample="sales_weekly.csv" data-template="line-trend">周报趋势</button>
                        <button type="button" class="intro-chip" data-sample="support_chat.csv" data-template="bar-compare">客服统计</button>
                        <button type="button" class="intro-chip" data-sample="finance_monthly.csv" data-template="pie-share">费用占比</button>
                    </div>
                    <p class="intro-note">点一个场景，马上上手；或直接上传/粘贴你的数据开始对话。</p>
                </div>
            </section>
            <section id="data-preview" aria-live="polite" aria-label="当前数据预览" class="sidebar-section empty">
                <header class="preview-header">
                    <h3 id="data-preview-title">当前数据源</h3>
                    <span class="preview-meta">实时展示当前选中数据的最近状态</span>
                    <button type="button" id="dt-toggle" class="ghost-btn" aria-controls="data-tools" aria-expanded="false" title="显示/隐藏数据工具">工具</button>
                </header>
                <div id="data-tools" class="data-tools" aria-label="数据工具">
                    <div class="tools-row">
                        <label for="dt-column-select">列</label>
                        <select id="dt-column-select" aria-label="选择列"></select>
                        <button type="button" id="dt-refresh-cols">刷新列</button>
                    </div>
                    <div class="tools-row">
                        <input id="dt-filter-value" type="text" placeholder="包含关键字"> 
                        <button type="button" id="dt-filter-apply">筛选包含</button>
                        <button type="button" id="dt-sort-asc">升序</button>
                        <button type="button" id="dt-sort-desc">降序</button>
                    </div>
                    <div class="tools-row">
                        <input id="dt-topk-k" type="number" min="1" value="10" aria-label="TopK 数量" style="width:80px"> 
                        <button type="button" id="dt-topk-apply">Top-K（按数值）</button>
                        <button type="button" id="dt-undo">撤销</button>
                        <button type="button" id="dt-redo">重做</button>
                    </div>
                    <div class="tools-row">
                        <button type="button" id="dt-export-csv" title="导出当前预览为CSV">导出CSV</button>
                        <button type="button" id="dt-reset" title="重置为原始数据">重置</button>
                    </div>
                    <div id="dt-hint" class="data-hint" aria-live="polite" aria-atomic="true"></div>
                </div>
                <div id="data-preview-table" class="preview-table"></div>
                <p id="data-preview-footnote" class="data-preview-footnote"></p>
            </section>
            <section id="guide-section" class="sidebar-section" aria-label="使用指南">
                <header class="sidebar-section-header">
                    <h2>使用指南</h2>
                    <button type="button" class="section-toggle" data-target="guide-section">▾</button>
                </header>
                <div class="section-body">
                    <div class="guide-controls">
                        <label for="guide-scenario">选择场景：</label>
                        <select id="guide-scenario" aria-label="选择引导场景">
                            <option value="quick-start">一分钟上手</option>
                        </select>
                        <button type="button" id="guide-start-btn" class="guide-start">开始引导</button>
                    </div>
                    <p class="guide-note">按照场景一步步带你完成关键操作。</p>
                </div>
            </section>
            <section id="chart-shortcuts" class="sidebar-section" aria-label="图表快捷指令">
                <header class="shortcuts-header">
                    <h3>常用统计图</h3>
                    <span>一键生成常见图表类型</span>
                    <button type="button" class="section-toggle" data-target="chart-shortcuts">▾</button>
                </header>
                <div class="section-body">
                    <div class="template-picker">
                        <label for="template-select">模板：</label>
                        <select id="template-select" aria-label="选择生成模板">
                            <option value="">选择一个模板</option>
                            <option value="line-trend">趋势折线图</option>
                            <option value="bar-compare">对比柱状图</option>
                            <option value="pie-share">占比饼图</option>
                            <option value="stacked-area">堆叠面积图</option>
                            <option value="scatter-relation">散点关系图</option>
                            <option value="radar-profile">雷达分布图</option>
                        </select>
                    </div>
                    <div id="chart-shortcut-list" role="list"></div>
                </div>
            </section>
        </div>
    </aside>
    <main id="main-content">
        <div id="chat-container">
            <div id="top-loading-bar" aria-hidden="true"></div>
            <header id="chat-header" aria-label="当前会话">
                <div class="chat-heading">
                    <div class="chat-identity">
                        <span class="chat-title">智表助手</span>
                        <span class="chat-status">随时准备分析数据</span>
                    </div>
                    <div class="chat-presence" aria-live="polite">
                        <span class="chat-presence-indicator" aria-hidden="true"></span>
                        <span class="chat-presence-text">在线</span>
                    </div>
                    <div class="chat-actions">
                        <button id="style-toggle" class="input-btn" type="button" aria-label="切换风格" title="切换风格">🎨</button>
                    </div>
                </div>
                <div id="dataset-tray" class="dataset-tray" aria-live="polite" aria-label="已上传数据源">
                    <span class="dataset-empty">尚未上传数据</span>
                </div>
            </header>
            <!-- 移动端欢迎页（已在移动端隐藏，保留结构以便未来启用） -->
            <section id="mobile-welcome" class="mobile-welcome" hidden aria-hidden="true" aria-label="欢迎">
                <h1 class="mw-title">智表</h1>
                <div class="mw-subtitle">对话式表格助手</div>
                <div class="mw-group">
                    <h3 class="mw-heading">示例</h3>
                    <div class="mw-cards" role="list">
                        <button type="button" class="mw-card mw-example" role="listitem" data-fill="请帮我整理出每周的销售额，并生成汇总表">“整理每周销售额” →</button>
                        <button type="button" class="mw-card mw-example" role="listitem" data-fill="从这些客服对话中提炼出前三大问题，并做统计">“提炼客服问题” →</button>
                        <button type="button" class="mw-card mw-example" role="listitem" data-fill="把原始订单数据转换成城市维度的对比表">“城市对比表” →</button>
                    </div>
                </div>
                <div class="mw-group">
                    <h3 class="mw-heading">能力</h3>
                    <ul class="mw-list">
                        <li>理解自然语言，自动清洗与整理表格</li>
                        <li>生成统计图表，支持导出图片与 Excel</li>
                    </ul>
                </div>
            </section>
            <section id="onboarding-banner" aria-label="快速开始指引" hidden>
                <div class="onboarding-primary">
                    <div class="onboarding-icon" aria-hidden="true">📊</div>
                    <div class="onboarding-copy">
                        <h2>两步开始你的数据对话</h2>
                        <p>先导入一份数据，再向智表助手提出问题，我们会马上给你结构化的结果与图表。</p>
                    </div>
                </div>
                <ol class="onboarding-steps">
                    <li>
                        <span class="step-number">1</span>
                        <div class="step-copy">
                            <strong>导入数据</strong>
                            <span>支持 Excel、CSV，或直接粘贴原始文本</span>
                        </div>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <div class="step-copy">
                            <strong>提出需求</strong>
                            <span>直接输入问题，或使用下面的快捷提示</span>
                        </div>
                    </li>
                </ol>
                <div class="onboarding-prompts" role="list">
                    <button type="button" class="prompt-chip" data-fill="请帮我整理出每周的销售额，并生成汇总表">整理每周销售额</button>
                    <button type="button" class="prompt-chip" data-fill="从这些客服对话中提炼出前三大问题，并做统计">提炼客服问题</button>
                    <button type="button" class="prompt-chip" data-fill="把原始订单数据转换成城市维度的对比表">城市对比表</button>
                </div>
                <div class="onboarding-demos">
                    <button type="button" class="demo-btn" data-sample="sales_weekly.csv">一键体验：销售周报</button>
                    <button type="button" class="demo-btn" data-sample="support_chat.csv">一键体验：客服统计</button>
                    <button type="button" class="demo-btn" data-sample="finance_monthly.csv">一键体验：财务月度</button>
                </div>
                <button id="banner-close" type="button" aria-label="关闭指引" class="onboarding-close">了解</button>
            </section>
            <div id="message-list"></div>
            <section id="data-input-panel" aria-hidden="true">
                <header class="panel-header">
                    <div>
                        <h3>粘贴数据</h3>
                        <p>支持 CSV 或制表符分隔文本，记得包含表头列名。</p>
                    </div>
                    <button type="button" id="data-paste-close" aria-label="关闭粘贴面板">✕</button>
                </header>
                <textarea id="data-paste-area" placeholder="在此粘贴数据，每列使用逗号或制表符分隔..."></textarea>
                <div class="panel-actions">
                    <button type="button" id="data-paste-cancel">清空</button>
                    <button type="button" id="data-paste-submit" class="primary">导入数据</button>
                </div>
            </section>
            <div id="upload-status" aria-live="polite" role="status"></div>
            <div id="input-hint" class="input-hint" aria-hidden="true">按 Enter 发送 · Shift + Enter 换行</div>
            <div id="input-prompts" class="input-prompts" aria-label="快捷提示" role="list">
                <button type="button" class="input-prompt-chip" data-fill="请生成一份趋势折线图，自动选择横轴与关键指标，并返回CSV与ECharts配置">📈 趋势图</button>
                <button type="button" class="input-prompt-chip" data-fill="请对当前数据做Top-10汇总，仅返回包含前10条的表格，并保持原有列名不变">🔟 Top-10汇总</button>
                <button type="button" class="input-prompt-chip" data-fill="请清洗空值与异常值，保留原列名并输出清洗后的表格">🧹 清洗空值</button>
            </div>
            <div id="input-area">
                <button id="mobile-plus-btn" class="input-btn" aria-label="更多操作" title="更多">＋</button>
                <div id="mobile-quick-actions" class="mobile-quick-actions" hidden aria-hidden="true" role="menu">
                    <button type="button" class="mobile-qa-item" data-act="upload" role="menuitem">📎 上传文件</button>
                    <button type="button" class="mobile-qa-item" data-act="paste" role="menuitem">📋 粘贴数据</button>
                    <button type="button" class="mobile-qa-item" data-act="new" role="menuitem">🔄 新会话</button>
                </div>
                <button id="new-session-btn" class="input-btn" aria-label="新会话">🔄</button>
                <button id="upload-btn" class="input-btn">📎</button>
                <input type="file" id="file-upload-input" style="display: none;">
                <button id="paste-btn" class="input-btn" aria-label="粘贴数据">📋</button>
                <button id="dark-mode-toggle" class="input-btn" type="button" aria-label="切换到深色模式">🌙</button>
                <textarea id="command-input" placeholder="请输入指令..."></textarea>
                <button id="send-btn" class="input-btn">➢</button>
            </div>
        </div>
    </main>
    <!-- 移动端抽屉幕布 -->
    <div id="mobile-backdrop" class="mobile-backdrop" hidden aria-hidden="true"></div>
    <!-- 引导覆盖层 -->
    <div id="guide-overlay" class="guide-overlay" hidden aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="guide-title">
        <div class="guide-backdrop" aria-hidden="true"></div>
        <div class="guide-modal" role="document">
            <div class="guide-header">
                <h3 id="guide-title">使用指南</h3>
                <button type="button" id="guide-close" class="guide-close" aria-label="关闭引导">✕</button>
            </div>
            <div class="guide-body">
                <p id="guide-step-title" class="guide-step-title"></p>
                <p id="guide-step-desc" class="guide-step-desc"></p>
            </div>
            <div class="guide-footer">
                <span id="guide-progress" class="guide-progress">1 / 1</span>
                <div class="guide-actions">
                    <button type="button" id="guide-prev" class="guide-btn" disabled>上一步</button>
                    <button type="button" id="guide-next" class="guide-btn primary">下一步</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
